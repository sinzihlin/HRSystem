# HR 薪資系統

這是一個使用 Python 和 Django 建置的人力資源薪資管理系統，提供完整的員工資料管理、打卡記錄、請假申請與審核流程等功能。

## 核心功能

- **員工管理:** 新增、編輯與檢視員工資料，支援 CSV 批次匯入功能。
- **薪資計算:** 根據預設規則（如：底薪、獎金、扣除額）自動計算每月薪資。
- **薪資單生成:** 產生每月的薪資報表。
- **管理後台:** 一個安全的管理後台，用於管理所有系統資料。
- **打卡功能:** 記錄員工的上下班打卡時間，包含日期與時間自訂，並在員工詳細頁面中查看完整打卡歷史。
- **請假管理:** 員工請假申請與 HR 審核流程，支援多種請假類型和審核通知。
- **前端互動:** 所有功能以模態視窗形式整合在單一介面，實現無刷新操作體驗。
- **安全認證:** 完整的使用者登入驗證與 CSRF 保護機制。
- **員工詳細資料頁面:** 提供員工完整資訊檢視，側邊欄顯示所有員工清單，方便在不同員工之間快速切換。

## 技術規格

- **後端框架:** Django 5.2.4
- **前端技術:** HTML, CSS, JavaScript (原生)
- **資料庫:** PostgreSQL (Docker), SQLite (傳統安裝)
- **API設計:** RESTful JSON API
- **安全機制:** Django 內建認證系統與 CSRF 保護
- **前端互動:** 模態視窗、AJAX 非同步請求、即時狀態更新

## 開發任務進度

- [x] **專案設定:** 初始化 Django 專案、設定資料庫並建立虛擬環境。
- [x] **資料模型:** 定義員工、部門、薪資等資料模型。
- [x] **管理後台:** 客製化 Django 管理介面以管理資料。
- [x] **業務邏輯:** 實作核心的薪資計算邏輯。
- [x] **前端介面:** 開發一個簡單的使用者介面來檢視薪資資訊。
- [x] **網頁匯入功能:** 透過彈出式視窗匯入員工資料。
- [x] **使用者驗證:** 透過使用者登入/登出機制保護應用程式安全。
- [x] **打卡功能:** 實作員工打卡紀錄功能。
- [x] **請假管理:** 實作員工請假申請與 HR 審核功能。
- [x] **員工詳細資料頁面:** 顯示個別員工的詳細資料與請假歷史。
- [x] **安全性強化:** 改進 CSRF 保護與錯誤處理機制。
- [x] **前端互動優化:** 增強錯誤處理與用戶反饋機制。
- [x] **側邊導航改進:** 實現員工詳細頁面側邊員工列表，便於快速切換不同員工資料。
- [x] **搜尋功能:** 在員工側邊列表添加即時搜尋功能，提高使用體驗。

## 薪資系統開發任務

### 第一階段：基礎設定與資料模型
- [ ] **薪資結構設定**
  - [ ] 建立基本薪資模型
    - [ ] 正職月薪制
      - [ ] 基本薪資
      - [ ] 特殊津貼（如：主管加給、專業加給、專案津貼等）
      - [ ] 變動津貼
    - [ ] 兼職時薪制
      - [ ] 時薪設定
      - [ ] 假日時薪加成
      - [ ] 特殊時段加給
  - [ ] 設計直觀的薪資項目管理介面
  - [ ] 實作薪資設定的 CRUD 功能

- [ ] **工時制度設定**
  - [ ] 建立班別管理模型
    - [ ] 正職班別
      - [ ] 一般班別（如：早班、晚班）
      - [ ] 彈性上下班時間
      - [ ] 輪班制度
    - [ ] 兼職班別
      - [ ] 彈性排班時段
      - [ ] 工時限制設定
      - [ ] 特殊時段設定（如：夜間、假日）
  - [ ] 設計班別管理介面
  - [ ] 實作個人排班功能
    - [ ] 正職員工固定/輪班排程
    - [ ] 兼職員工彈性排班
    - [ ] 每週工時追蹤
  - [ ] 支援批次排班設定

- [ ] **加班制度設定**
  - [ ] 建立加班費計算規則模型（支援徹底加班費計算）
  - [ ] 設計加班費計算規則管理介面
  - [ ] 實作加班時數追蹤功能

- [ ] **稅務設定**
  - [ ] 建立勞健保費率設定模型
  - [ ] 建立多種所得稅扣繳規則模型
  - [ ] 實作稅務設定管理介面

### 第二階段：薪資計算引擎
- [ ] **出勤整合計算**
  - [ ] 整合現有打卡系統資料
  - [ ] 實作加班費計算邏輯
    - [ ] 平日加班
    - [ ] 假日加班
    - [ ] 特殊節日加班
  - [ ] 實作請假扣款邏輯
  - [ ] 設計遲到早退規則

- [ ] **薪資計算核心**
  - [ ] 實作基本月薪計算
  - [ ] 開發特殊津貼計算模組
  - [ ] 整合加班費計算
  - [ ] 實作勞健保費計算
  - [ ] 建立多種所得稅計算功能

### 第三階段：使用者介面優化
- [ ] **管理後台介面**
  - [ ] 設計簡潔現代的後台主題
  - [ ] 優化資料輸入表單
  - [ ] 加入即時驗證功能
  - [ ] 實作操作引導提示

- [ ] **員工薪資查詢介面**
  - [ ] 設計響應式介面
  - [ ] 實作薪資明細檢視
  - [ ] 開發薪資歷史查詢
  - [ ] 加入視覺化圖表

### 第四階段：資料匯出與權限管理
- [ ] **資料匯出功能**
  - [ ] 開發 Excel 格式匯出
  - [ ] 實作 CSV 格式匯出
  - [ ] 建立自訂格式匯出功能

- [ ] **權限控制**
  - [ ] 設定薪資資料存取權限
  - [ ] 實作主管審核機制
  - [ ] 建立操作日誌記錄

- [ ] **系統測試**
  - [ ] 進行功能測試
  - [ ] 執行壓力測試
  - [ ] 進行使用者體驗測試
  - [ ] 執行安全性測試

### 第五階段：部署與文件
- [ ] **系統部署**
  - [ ] 更新部署文件
  - [ ] 準備資料庫遷移腳本
  - [ ] 設定自動備份機制

- [ ] **使用說明文件**
  - [ ] 撰寫操作手冊
  - [ ] 製作操作影片教學
  - [ ] 建立常見問題集

## 安裝與設定

本系統提供兩種部署方式：傳統方式和 Docker 容器化方式。

### 方式一：使用 Docker（推薦）

#### 環境需求
- Docker Desktop
- Docker Compose

#### 安裝步驟

1. **複製專案倉庫:**
   ```bash
   git clone <repository-url>
   cd HRSystem
   ```

2. **使用 Docker Compose 啟動服務:**
   ```bash
   docker-compose up -d
   ```

3. **執行資料庫遷移:**
   ```bash
   docker-compose exec web python manage.py migrate
   ```

4. **建立管理員帳號:**
   ```bash
   docker-compose exec web python manage.py createsuperuser
   ```

5. **產生測試資料 (選擇性):**
   ```bash
   docker-compose exec web python create_fake_data.py
   ```

系統將在 http://localhost:8000 運行，使用 PostgreSQL 作為資料庫。

### 方式二：傳統安裝 (使用 SQLite)

#### 環境需求
- Python 3.11 或以上
- pip (Python 套件安裝工具)
- 瀏覽器支援現代 JavaScript 功能 (ES6+)

#### 安裝步驟

1. **複製專案倉庫:**
   ```bash
   git clone <repository-url>
   cd HRSystem
   ```

2. **建立並啟用虛擬環境:**
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   ```
   *在 Windows 上，請使用 `.venv\Scripts\activate`*

3. **安裝相依套件:**
   ```bash
   pip install django mysqlclient python-dotenv psycopg2-binary
   ```

4. **修改資料庫設定:**
   
   編輯 `HRSystem/settings.py` 檔案，將資料庫設定改為使用 SQLite：
   ```python
   DATABASES = {
       'default': {
           'ENGINE': 'django.db.backends.sqlite3',
           'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
       }
   }
   ```

#### 執行應用程式

1. **套用資料庫遷移:**
   ```bash
   python manage.py migrate
   ```

2. **建立管理員帳號:**
   ```bash
   python manage.py createsuperuser
   ```
   建議使用簡單的帳號密碼組合，例如：
   - 使用者名稱：admin
   - 密碼：admin123

3. **啟動開發伺服器:**
   ```bash
   python manage.py runserver
   ```

4. **產生測試資料 (選擇性):**
   ```bash
   python create_fake_data.py
   ```

應用程式將會運行在 `http://127.0.0.1:8000` 或 `http://localhost:8000`。

#### 快速訪問連結
- 首頁: `http://localhost:8000/`（會自動重定向到員工列表）
- 員工列表: `http://localhost:8000/employees/`
- 管理後台: `http://localhost:8000/admin`
- 登入頁面: `http://localhost:8000/login/`

## 使用指南

### 使用者登入

1. 訪問 http://localhost:8000/login/ 或 http://localhost:8000/ （會自動重定向到登入頁面）
2. 使用在 `createsuperuser` 步驟中建立的管理員帳號登入（例如：admin/admin123）
3. 登入成功後會自動重定向到員工列表頁面
4. 只有具備管理員權限的用戶可以存取員工列表和操作功能

### 員工管理

1. **檢視員工列表:** 
   - 登入後自動進入員工列表頁面
   - 可以在側邊欄查看所有員工
   - 使用搜尋功能快速找到特定員工

2. **匯入員工資料:** 
   - 點擊「匯入員工資料」按鈕
   - 上傳符合格式的 CSV 檔案
   - CSV 檔案格式要求：員工編號,姓名,部門,職位,薪資

3. **員工打卡:** 
   - 點擊員工列表中的「打卡」按鈕
   - 選擇上班/下班
   - 可以設定特定的日期時間
   - 打卡記錄會即時顯示在員工詳細資料頁面

4. **員工請假:** 
   - 點擊員工列表中的「請假」按鈕
   - 選擇請假類型（例如：事假、病假）
   - 設定請假的開始和結束日期
   - 填寫請假原因

5. **審核請假:** 
   - 點擊「審核請假」按鈕
   - 查看所有待審核的請假申請
   - 可以選擇批准或拒絕請假
   - 審核結果會即時更新在介面上

### 使用管理後台

1. 訪問 http://localhost:8000/admin
2. 使用管理員帳號登入
3. 可以直接管理：
   - 員工資料
   - 部門資訊
   - 薪資記錄
   - 打卡記錄
   - 請假申請
4. 支援進階篩選和搜尋功能
6. **查看詳細資料:** 點擊員工姓名可查看該員工的詳細資料、完整打卡記錄和請假歷史
7. **員工快速切換:** 在員工詳細資料頁面左側，使用員工列表可直接切換到其他員工資料
8. **搜尋員工:** 在詳細資料頁面的左側列表中使用搜尋框快速過濾並找到特定員工

## 專案結構

```
/
├── HRSystem/         # Django 專案設定
│   ├── settings.py   # 主要設定檔
│   ├── urls.py       # 主要 URL 路由
│   └── ...
├── employee/         # 員工應用模組
│   ├── models.py     # 資料模型定義
│   ├── views.py      # 視圖和 API 端點
│   ├── urls.py       # URL 路由配置
│   ├── templates/    # HTML 模板
│   └── ...
├── venv/             # 虛擬環境
├── manage.py         # Django 命令列工具
├── create_fake_data.py # 產生測試資料的腳本
└── requirements.txt  # 專案相依套件
```

## 主要功能說明

### 員工資料匯入

系統支援透過 CSV 檔案批次匯入員工資料。CSV 檔案必須包含以下欄位：
- `name`: 員工姓名
- `email`: 電子郵件 (用作唯一識別)
- `phone`: 電話號碼
- `department_name`: 部門名稱
- `hire_date`: 到職日期 (YYYY-MM-DD 格式)

### 打卡系統

- 支援上班和下班打卡
- 可自訂打卡日期和時間
- 系統自動記錄打卡類型和時間
- 可在員工詳細頁面查看完整打卡記錄歷史

### 請假管理

- 支援多種請假類型：特休、病假、事假、婚假、喪假、產假、陪產假、公假、補休
- 請假流程：申請 → 審核 → 核准/拒絕
- 待審核通知機制：未審核的請假會在「審核請假」按鈕旁顯示紅點提醒

### 安全性與前端互動

- 所有 API 請求都經過 CSRF 保護
- AJAX 非同步請求處理所有操作，無需頁面重新整理
- 適當的錯誤處理和用戶反饋機制
- 資料驗證確保輸入資料的完整性

## 常見問題與故障排除

### 按鈕無法正常運作？

如果按鈕點擊沒有反應，請檢查：

1. **確認已正確登入：** 所有功能僅適用於已登入且具備管理員權限的用戶
2. **檢查瀏覽器控制台：** 按 F12 開啟開發者工具，查看 Console 標籤中是否有錯誤訊息
3. **CSRF 令牌：** 確保頁面上的 CSRF 令牌正確並且未過期
4. **網路請求：** 在開發者工具的 Network 標籤中檢查 API 請求是否有發送和回應

### 資料匯入失敗？

1. 確認 CSV 檔案格式正確，包含所有必要欄位
2. 檢查日期格式是否為 YYYY-MM-DD
3. 檢查 CSV 檔案的編碼是否為 UTF-8

## 聯絡與支援

如有任何問題或需要協助，請聯絡系統管理員或開發團隊。