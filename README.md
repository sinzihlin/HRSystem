# 🏢 HR 薪資管理系統

[![Version](https://img.shields.io/badge/version-v2.1.0-blue.svg)](https://github.com/your-repo/releases)
[![Django](https://img.shields.io/badge/Django-5.2.4-green.svg)](https://djangoproject.com/)
[![Python](https://img.shields.io/badge/Python-3.11+-yellow.svg)](https://python.org/)
[![License](https://img.shields.io/badge/license-MIT-orange.svg)](LICENSE)

> 🚀 **智能化薪資管理系統** - 支援自動請假扣款、精確加班費計算、智能稅務處理

這是一個使用 Python 和 Django 建置的現代化人力資源薪資管理系統，提供完整的員工資料管理、智能薪資計算、打卡記錄、請假申請與審核流程等功能。特別針對中小型企業的人事管理需求設計，具備高度自動化和智能化特色。

### ✨ 最新亮點 (v2.1.0)
- 🤖 **全自動請假扣款** - 事假、病假智能扣款計算
- 💰 **精確加班費** - 平日1.33倍、假日2.0倍自動計算  
- 🏛️ **智能稅務** - 勞健保、所得稅自動處理
- 👁️ **即時預覽** - 薪資計算結果透明可見

## 系統特點

### 🚀 **智能化薪資管理**
- **全自動計算:** 請假扣款、加班費、稅務項目全自動化
- **即時預覽:** 薪資計算結果即時預覽，避免錯誤
- **透明計算:** 詳細的薪資明細，每項計算清楚可見
- **精確稅務:** 自動計算勞保費、健保費、所得稅

### 💼 **彈性的薪資結構**
- **雙軌制支援:** 正職月薪制和兼職時薪制並行
- **多元津貼:** 可自訂各種津貼和加給項目（主管加給、專業津貼、交通補助等）
- **智能加班費:** 平日 1.33 倍、假日 2.0 倍，自動識別節假日
- **請假扣款:** 事假、病假等無薪假自動扣款計算

### ⚡ **靈活的工時管理**
- **多種班別:** 支援固定班、輪班、彈性班、兼職班
- **智能出勤:** 自動統計工作時數和加班時數
- **請假整合:** 請假天數自動影響薪資計算
- **特殊時段:** 夜班、假日等特殊時段加給

### 🎨 **人性化的介面設計**
- **直覺操作:** 清晰的操作流程和即時反饋
- **響應式設計:** 支援各種裝置和螢幕尺寸
- **模態視窗:** 無刷新操作體驗
- **視覺化呈現:** 豐富的資料圖表和統計

## 核心功能

### 💼 員工管理
- **員工資料管理:** 新增、編輯與檢視員工資料，支援 CSV 批次匯入功能
- **部門管理:** 靈活的部門結構設定
- **員工詳細資料頁面:** 提供員工完整資訊檢視，側邊欄顯示所有員工清單，方便在不同員工之間快速切換

### 💰 智能薪資計算系統
- **彈性薪資結構:** 支援正職月薪制和兼職時薪制
- **自動薪資計算:** 根據預設規則（如：底薪、獎金、扣除額）自動計算每月薪資
- **✨ 請假扣款自動化:** 
  - 智能計算事假、病假等無薪假的自動扣款
  - 支援薪資期間內的請假天數重疊處理
  - 針對正職和兼職員工的不同日薪計算邏輯
- **✨ 精確加班費計算:**
  - 平日加班：1.33 倍薪資
  - 假日加班：2.0 倍薪資  
  - 自動識別國定假日和週末
- **✨ 自動稅務計算:**
  - 勞保費自動扣除（10.50%）
  - 健保費自動扣除（5.17%）
  - 所得稅自動扣除（5.00%）
- **✨ 薪資計算預覽:** 即時預覽薪資計算結果，包含詳細的計算明細
- **薪資單生成:** 產生每月的詳細薪資報表

### ⏰ 出勤管理
- **打卡功能:** 記錄員工的上下班打卡時間，包含日期與時間自訂，並在員工詳細頁面中查看完整打卡歷史
- **工時統計:** 自動統計每日工作時數和加班時數
- **班別管理:** 支援多種班別（固定班、輪班、彈性班、兼職班）

### 📋 請假管理
- **請假申請:** 支援多種請假類型（特休、病假、事假、婚假、喪假、產假、陪產假、公假、補休）
- **審核流程:** HR 審核機制，支援批准或拒絕請假申請
- **請假通知:** 待審核請假會在「審核請假」按鈕旁顯示紅點提醒
- **請假歷史:** 完整的請假記錄查詢

### 🔒 系統安全與管理
- **管理後台:** 一個安全的管理後台，用於管理所有系統資料
- **前端互動:** 所有功能以模態視窗形式整合在單一介面，實現無刷新操作體驗
- **安全認證:** 完整的使用者登入驗證與 CSRF 保護機制
- **權限控制:** 細粒度的使用者權限管理

## 技術規格

### 🔧 後端技術
- **框架:** Django 5.2.4
- **Python 版本:** 3.11 或以上
- **資料庫:** 
  - PostgreSQL 13+ (Docker 環境)
  - SQLite 3 (開發環境)
- **API:** RESTful JSON API
- **計算引擎:** 
  - `SalaryCalculationService` 智能薪資計算服務
  - `Decimal` 精確數值計算
  - 自動化稅務和扣款計算
- **快取:** Django 內建快取系統
- **任務佇列:** Celery (用於排程任務)

### 🎨 前端技術
- **基礎:** HTML5, CSS3, JavaScript (ES6+)
- **CSS 框架:** Bootstrap 5
- **互動增強:** 
  - 薪資計算即時預覽
  - 模態視窗無刷新操作
  - AJAX 非同步資料處理
- **JavaScript 庫:** 
  - jQuery 3.6+ (DOM 操作和 AJAX)
  - Chart.js (資料視覺化)
  - DataTables (表格增強)
- **互動功能:**
  - 模態視窗
  - AJAX 非同步請求
  - 即時表單驗證
  - 動態資料更新

### 安全性
- **認證:** Django 內建認證系統
- **授權:** 細粒度權限控制
- **安全防護:**
  - CSRF 保護
  - XSS 防護
  - SQL 注入防護
  - 密碼雜湊處理

## 開發任務進度

### ✅ 已完成功能
- [x] **專案設定:** 初始化 Django 專案、設定資料庫並建立虛擬環境
- [x] **資料模型:** 定義員工、部門、薪資等資料模型
- [x] **管理後台:** 客製化 Django 管理介面以管理資料
- [x] **業務邏輯:** 實作核心的薪資計算邏輯
- [x] **前端介面:** 開發一個簡單的使用者介面來檢視薪資資訊
- [x] **網頁匯入功能:** 透過彈出式視窗匯入員工資料
- [x] **使用者驗證:** 透過使用者登入/登出機制保護應用程式安全
- [x] **打卡功能:** 實作員工打卡紀錄功能
- [x] **請假管理:** 實作員工請假申請與 HR 審核功能
- [x] **員工詳細資料頁面:** 顯示個別員工的詳細資料與請假歷史
- [x] **安全性強化:** 改進 CSRF 保護與錯誤處理機制
- [x] **前端互動優化:** 增強錯誤處理與用戶反饋機制
- [x] **側邊導航改進:** 實現員工詳細頁面側邊員工列表，便於快速切換不同員工資料
- [x] **搜尋功能:** 在員工側邊列表添加即時搜尋功能，提高使用體驗

### 🚀 最新完成：智能薪資系統 (2025年7月)
- [x] **請假扣款自動化:** 事假、病假等無薪假自動扣款計算
- [x] **精確加班費計算:** 平日1.33倍、假日2.0倍，自動識別節假日
- [x] **自動稅務計算:** 勞保費、健保費、所得稅自動計算和扣除
- [x] **薪資計算預覽:** 即時預覽功能，透明顯示所有計算細節
- [x] **智能薪資項目管理:** 自動創建和管理各種津貼、獎金、扣除項目
- [x] **優化使用者介面:** 新增預覽模態框和改進的薪資列表介面

## 薪資系統開發里程碑

### ✅ 第一階段：基礎設定與資料模型 (已完成)
- [x] **薪資結構設定**
  - [x] 建立基本薪資模型 (正職月薪制、兼職時薪制)
  - [x] 特殊津貼系統 (主管加給、專業加給、交通津貼等)
  - [x] 變動津貼和獎金機制
  - [x] 直觀的薪資項目管理介面
  - [x] 薪資設定的 CRUD 功能

- [x] **工時制度設定**
  - [x] 班別管理模型 (固定班、彈性班、輪班、兼職班)
  - [x] 彈性上下班時間設定
  - [x] 特殊時段設定 (夜間、假日)
  - [x] 班別管理介面

- [x] **稅務設定**
  - [x] 勞健保費率自動計算 (勞保10.50%、健保5.17%)
  - [x] 所得稅扣繳規則 (5.00%)
  - [x] 稅務設定自動化

### ✅ 第二階段：薪資計算引擎 (已完成)
- [x] **出勤整合計算**
  - [x] 整合打卡系統資料
  - [x] 加班費計算邏輯 (平日1.33倍、假日2.0倍)
  - [x] 請假扣款邏輯 (事假、病假自動扣款)
  - [x] 智能節假日識別

- [x] **薪資計算核心**
  - [x] 基本月薪和時薪計算
  - [x] 特殊津貼計算模組
  - [x] 加班費精確計算
  - [x] 勞健保費自動計算
  - [x] 所得稅計算功能
  - [x] 薪資計算預覽功能

### 🚧 第三階段：使用者介面優化 (進行中)
### 🚧 第三階段：使用者介面優化 (已完成)
- [x] **管理後台介面**
  - [x] 簡潔現代的後台主題
  - [x] 優化資料輸入表單
  - [x] 即時驗證功能
  - [ ] 實作操作引導提示

- [x] **薪資查詢介面**
  - [x] 響應式介面設計
  - [x] 薪資明細檢視
  - [x] 薪資計算預覽功能
  - [x] 薪資歷史查詢優化
  - [x] 視覺化圖表增強

### 📋 第四階段：資料匯出與權限管理 (待開發)
- [ ] **資料匯出功能**
  - [ ] Excel 格式匯出
  - [ ] CSV 格式匯出
  - [ ] 自訂格式匯出功能

- [ ] **權限控制**
  - [ ] 薪資資料存取權限
  - [ ] 主管審核機制
  - [ ] 操作日誌記錄

### 🧪 第五階段：系統測試與優化 (待開發)
- [ ] **系統測試**
  - [ ] 功能測試
  - [ ] 壓力測試
  - [ ] 使用者體驗測試
  - [ ] 安全性測試

### 🚀 第六階段：部署與文件 (待開發)
- [ ] **系統部署**
  - [ ] 更新部署文件
  - [ ] 準備資料庫遷移腳本
  - [ ] 設定自動備份機制

- [ ] **使用說明文件**
  - [ ] 撰寫操作手冊
  - [ ] 製作操作影片教學
  - [ ] 建立常見問題集

### ✅ 第七階段：打卡紀錄管理 (已完成)
- [x] **新增打卡紀錄頁面**
  - [x] 建立獨立的員工打卡紀錄頁面，顯示指定員工的打卡歷史。
  - [x] 頁面內嵌表單，可直接新增該員工的打卡紀錄。
  - [x] 頁面 UI/UX 風格與薪資管理系統保持一致，包含左側員工列表側邊欄。
  - [x] 實現員工列表側邊欄的搜尋和選中功能，並能跳轉到其他員工的打卡紀錄頁面。

## 📈 更新日誌

### v2.2.0 (2025年7月21日) - 薪資查詢介面優化完成
#### 🚀 新功能
- **進階薪資篩選**: 新增年份、月份、狀態等多重篩選條件
- **統計資訊面板**: 即時顯示薪資記錄總數、總薪資和平均薪資
- **互動式圖表系統**: 
  - 月度薪資趨勢圖（線形圖）
  - 部門薪資分析圖（柱狀圖）  
  - 薪資分布圖（甜甜圈圖）
- **資料匯出功能**: 支援 CSV 格式匯出，包含詳細和簡要兩種模式
- **響應式設計**: 完整的行動裝置適配

#### 🔧 改進
- 優化薪資列表介面布局，採用更直觀的多行篩選設計
- 增強使用者體驗，加入載入動畫和錯誤處理
- 改進 API 架構，新增 `salary_chart_data` 和 `salary_export` 端點
- 統計數據即時計算，提供更準確的數據洞察

#### 🛠️ 技術升級
- 整合 Chart.js 圖表庫進行資料視覺化
- 新增 Font Awesome 圖示庫提升視覺體驗
- 實作完整的 CSV 匯出功能，支援 UTF-8 編碼
- 優化資料庫查詢效能，使用聚合函數進行統計

### v2.1.0 (2025年7月21日) - 智能薪資系統
#### 🚀 新功能
- **請假扣款自動化**: 事假、病假等無薪假自動扣款計算
- **精確加班費計算**: 平日1.33倍、假日2.0倍，智能識別節假日
- **自動稅務計算**: 勞保費、健保費、所得稅自動計算
- **薪資計算預覽**: 即時預覽功能，透明顯示計算細節
- **智能薪資項目**: 自動創建各種津貼、獎金、扣除項目

#### 🔧 改進
- 優化薪資列表介面，新增預覽按鈕
- 改進薪資計算邏輯，提升準確性
- 增強使用者體驗，提供詳細的計算明細

#### 🛠️ 技術升級
- 新增 `SalaryCalculationService` 薪資計算服務
- 實作 `salary_calculation_preview` API
- 優化資料庫查詢效能

### 第三階段：使用者介面優化
- [ ] **管理後台介面**
  - [ ] 設計簡潔現代的後台主題
  - [ ] 優化資料輸入表單
  - [ ] 加入即時驗證功能
  - [ ] 實作操作引導提示

- [ ] **員工薪資查詢介面**
  - [ ] 設計響應式介面
  - [ ] 實作薪資明細檢視
  - [ ] 開發薪資歷史查詢
  - [ ] 加入視覺化圖表

### 第四階段：資料匯出與權限管理
- [ ] **資料匯出功能**
  - [ ] 開發 Excel 格式匯出
  - [ ] 實作 CSV 格式匯出
  - [ ] 建立自訂格式匯出功能

- [ ] **權限控制**
  - [ ] 設定薪資資料存取權限
  - [ ] 實作主管審核機制
  - [ ] 建立操作日誌記錄

- [ ] **系統測試**
  - [ ] 進行功能測試
  - [ ] 執行壓力測試
  - [ ] 進行使用者體驗測試
  - [ ] 執行安全性測試

### 第五階段：部署與文件
- [ ] **系統部署**
  - [ ] 更新部署文件
  - [ ] 準備資料庫遷移腳本
  - [ ] 設定自動備份機制

- [ ] **使用說明文件**
  - [ ] 撰寫操作手冊
  - [ ] 製作操作影片教學
  - [ ] 建立常見問題集

## 安裝與設定

本系統提供兩種部署方式：傳統方式和 Docker 容器化方式。

### 方式一：使用 Docker（推薦）

#### 環境需求
- Docker Desktop
- Docker Compose

#### 安裝步驟

1. **複製專案倉庫:**
   ```bash
   git clone <repository-url>
   cd HRSystem
   ```

2. **使用 Docker Compose 啟動服務:**
   ```bash
   docker-compose up -d
   ```

3. **執行資料庫遷移:**
   ```bash
   docker-compose exec web python manage.py migrate
   ```

4. **建立管理員帳號:**
   ```bash
   docker-compose exec web python manage.py createsuperuser
   ```

5. **產生測試資料 (選擇性):**
   ```bash
   docker-compose exec web python scripts/create_fake_data.py
   ```

系統將在 http://localhost:8000 運行，使用 PostgreSQL 作為資料庫。

### 方式二：傳統安裝 (使用 SQLite)

#### 環境需求
- Python 3.11 或以上
- pip (Python 套件安裝工具)
- 瀏覽器支援現代 JavaScript 功能 (ES6+)

#### 安裝步驟

1. **複製專案倉庫:**
   ```bash
   git clone <repository-url>
   cd HRSystem
   ```

2. **建立並啟用虛擬環境:**
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   ```
   *在 Windows 上，請使用 `.venv\Scripts\activate`*

3. **安裝相依套件:**
   ```bash
   pip install django mysqlclient python-dotenv psycopg2-binary
   ```

4. **修改資料庫設定:**
   
   編輯 `HRSystem/settings.py` 檔案，將資料庫設定改為使用 SQLite：
   ```python
   DATABASES = {
       'default': {
           'ENGINE': 'django.db.backends.sqlite3',
           'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
       }
   }
   ```

#### 執行應用程式

1. **套用資料庫遷移:**
   ```bash
   python manage.py migrate
   ```

2. **建立管理員帳號:**
   ```bash
   python manage.py createsuperuser
   ```
   建議使用簡單的帳號密碼組合，例如：
   - 使用者名稱：admin
   - 密碼：admin123

3. **啟動開發伺服器:**
   ```bash
   python manage.py runserver
   ```

4. **產生測試資料 (選擇性):**
   
   **快速設置 (推薦):**
   ```bash
   ./setup_data.sh
   ```
   
   **手動執行 (可選):**
   ```bash
   # 基本測試資料
   python scripts/create_simple_fake_data.py
   
   # 完整測試資料
   python scripts/create_fake_data.py
   
   # 更多員工資料
   python scripts/create_more_fake_data.py
   
   # 打卡記錄
   python scripts/create_punch_records.py
   ```

應用程式將會運行在 `http://127.0.0.1:8000` 或 `http://localhost:8000`。

#### 快速訪問連結
- 首頁: `http://localhost:8000/`（會自動重定向到員工列表）
- 員工列表: `http://localhost:8000/employees/`
- 管理後台: `http://localhost:8000/admin`
- 登入頁面: `http://localhost:8000/login/`

## 使用指南

### 使用者登入

1. 訪問 http://localhost:8000/login/ 或 http://localhost:8000/ （會自動重定向到登入頁面）
2. 使用在 `createsuperuser` 步驟中建立的管理員帳號登入（例如：admin/admin123）
3. 登入成功後會自動重定向到員工列表頁面
4. 只有具備管理員權限的用戶可以存取員工列表和操作功能

### 員工管理

1. **檢視員工列表:** 
   - 登入後自動進入員工列表頁面
   - 可以在側邊欄查看所有員工
   - 使用搜尋功能快速找到特定員工

2. **匯入員工資料:** 
   - 點擊「匯入員工資料」按鈕
   - 上傳符合格式的 CSV 檔案
   - CSV 檔案格式要求：員工編號,姓名,部門,職位,薪資

3. **員工打卡:** 
   - 點擊員工列表中的「打卡」按鈕
   - 選擇上班/下班
   - 可以設定特定的日期時間
   - 打卡記錄會即時顯示在員工詳細資料頁面

4. **員工請假:** 
   - 點擊員工列表中的「請假」按鈕
   - 選擇請假類型（例如：事假、病假）
   - 設定請假的開始和結束日期
   - 填寫請假原因

5. **審核請假:** 
   - 點擊「審核請假」按鈕
   - 查看所有待審核的請假申請
   - 可以選擇批准或拒絕請假
   - 審核結果會即時更新在介面上

### 使用管理後台

1. 訪問 http://localhost:8000/admin
2. 使用管理員帳號登入
3. 可以直接管理：
   - 員工資料
   - 部門資訊
   - 薪資記錄
   - 打卡記錄
   - 請假申請
4. 支援進階篩選和搜尋功能
6. **查看詳細資料:** 點擊員工姓名可查看該員工的詳細資料、完整打卡記錄和請假歷史
7. **員工快速切換:** 在員工詳細資料頁面左側，使用員工列表可直接切換到其他員工資料
8. **搜尋員工:** 在詳細資料頁面的左側列表中使用搜尋框快速過濾並找到特定員工

## 專案結構

```
/
├── HRSystem/         # Django 專案設定
│   ├── settings.py   # 主要設定檔
│   ├── urls.py       # 主要 URL 路由
│   └── ...
├── employee/         # 員工應用模組
│   ├── models.py     # 資料模型定義
│   ├── views.py      # 視圖和 API 端點
│   ├── urls.py       # URL 路由配置
│   ├── templates/    # HTML 模板
│   └── ...
├── scripts/          # 測試資料腳本
│   ├── create_fake_data.py        # 產生完整測試資料的腳本
│   ├── create_simple_fake_data.py # 產生基本測試資料的腳本
│   └── ...
├── venv/             # 虛擬環境
├── manage.py         # Django 命令列工具
└── requirements.txt  # 專案相依套件
```

## 主要功能說明

### 員工資料匯入

系統支援透過 CSV 檔案批次匯入員工資料。CSV 檔案必須包含以下欄位：
- `name`: 員工姓名
- `email`: 電子郵件 (用作唯一識別)
- `phone`: 電話號碼
- `department_name`: 部門名稱
- `hire_date`: 到職日期 (YYYY-MM-DD 格式)

### 打卡系統

- 支援上班和下班打卡
- 可自訂打卡日期和時間
- 系統自動記錄打卡類型和時間
- 可在員工詳細頁面查看完整打卡記錄歷史

### 請假管理

- 支援多種請假類型：特休、病假、事假、婚假、喪假、產假、陪產假、公假、補休
- 請假流程：申請 → 審核 → 核准/拒絕
- 待審核通知機制：未審核的請假會在「審核請假」按鈕旁顯示紅點提醒

### 安全性與前端互動

- 所有 API 請求都經過 CSRF 保護
- AJAX 非同步請求處理所有操作，無需頁面重新整理
- 適當的錯誤處理和用戶反饋機制
- 資料驗證確保輸入資料的完整性

## 常見問題與故障排除

### 按鈕無法正常運作？

如果按鈕點擊沒有反應，請檢查：

1. **確認已正確登入：** 所有功能僅適用於已登入且具備管理員權限的用戶
2. **檢查瀏覽器控制台：** 按 F12 開啟開發者工具，查看 Console 標籤中是否有錯誤訊息
3. **CSRF 令牌：** 確保頁面上的 CSRF 令牌正確並且未過期
4. **網路請求：** 在開發者工具的 Network 標籤中檢查 API 請求是否有發送和回應

### 資料匯入失敗？

1. 確認 CSV 檔案格式正確，包含所有必要欄位
2. 檢查日期格式是否為 YYYY-MM-DD
3. 檢查 CSV 檔案的編碼是否為 UTF-8

## 聯絡與支援

如有任何問題或需要協助，請聯絡系統管理員或開發團隊。